<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>宝箱ゲーム🎁</title>
<style>
body {
  font-family: "Hiragino Kaku Gothic ProN", "Arial", sans-serif;
  background: radial-gradient(circle at top, #ffbb88 0%, #ff8855 40%, #553399 100%);
  height: 100vh;
  margin: 0;
  text-align: center;
  overflow: hidden;
  touch-action: manipulation;
}

/* スタート */
#startScreen {
  position:absolute; inset:0;
  background:rgba(0,0,0,0.5);
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  color:white; font-size:28px; backdrop-filter:blur(5px); z-index:100;
}
#startBtn {
  background: linear-gradient(90deg,#ff9f00,#ff6b6b);
  border:none; padding:15px 40px; font-size:24px; border-radius:50px;
  margin-top:20px; cursor:pointer; color:white; font-weight:bold;
  transition:0.2s; box-shadow:0 4px #c75d00;
}
#startBtn:active{ transform:scale(0.95); }

/* 宝箱 */
#chestBtn {
  position:absolute; cursor:pointer; background:transparent; border:none;
  left:50%; top:60%; transform:translate(-50%,-50%) scale(1);
  font-size: 9vw; padding:0;
  transition:left 0.35s ease, top 0.35s ease, transform 0.2s ease-out, filter 0.4s ease;
  user-select:none; display:none; touch-action:manipulation;
}
@keyframes tapShrink {
  0%{transform:translate(-50%, -50%) scale(1);}
  50%{transform:translate(-50%, -50%) scale(0.92);}
  100%{transform:translate(-50%, -50%) scale(1.08);}
}
.shrink { animation: tapShrink .25s ease-out; }

/* バブル */
.bubble {
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  font-size:22px; font-weight:bold; color:#fffceb; text-shadow:0 0 8px #000;
  text-align:center; max-width:85vw; line-height:1.5;
  animation:bubbleMove 6s forwards; z-index:10; pointer-events:none;
}
@keyframes bubbleMove {
  0%   {opacity:1; transform:translate(-50%, -50%) scale(1);}
  70%  {opacity:1; transform:translate(-50%, -60%) scale(1.2);}
  100% {opacity:0; transform:translate(-50%, -120%) scale(1.35);}
}

/* 光ぶわっ */
.burst {
  position:absolute; left:50%; top:50%;
  transform:translate(-50%, -50%);
  width:200px; height:200px;
  background:radial-gradient(circle, rgba(255,255,255,0.9) 0%, transparent 70%);
  opacity:0; pointer-events:none;
  animation:burstAnim 0.6s ease-out forwards;
  z-index:5;
}
@keyframes burstAnim {
  0%{opacity:1; transform:translate(-50%,-50%) scale(0.3);}
  100%{opacity:0; transform:translate(-50%,-50%) scale(2);}
}

/* 紙吹雪 */
.confetti {
  position: fixed; width: 10px; height: 10px; opacity:0.9;
  animation: confettiFall 3s linear forwards; pointer-events:none;
}
@keyframes confettiFall {
  0%   { transform:translateY(0) rotate(0deg);}
  100% { transform:translateY(100vh) rotate(720deg);}
}

/* クリア表示 */
#win {
  font-size:26px; color:white; text-shadow:0 0 8px black;
  display:none; line-height:1.6; padding:0 12px; max-width:100vw; text-align:center;
}
#win span { color:#ffeb3b; }
#win a { color:#fff; text-decoration:underline; font-size:22px; }

/* ★ 虹色メッセージ */
.rainbow {
  font-size: 32px;
  font-weight: 900;
  display:block;
  margin-bottom:12px;
  animation: rainbowColor 3s infinite linear, rainbowGlow 2s infinite ease-in-out;
}
@keyframes rainbowColor {
  0% { color: #ff6b6b; }
  20% { color: #ffdd59; }
  40% { color: #1dd1a1; }
  60% { color: #54a0ff; }
  80% { color: #c56cf0; }
  100% { color: #ff6b6b; }
}
@keyframes rainbowGlow {
  0%   { text-shadow:0 0 4px #fff; transform:scale(1); }
  50%  { text-shadow:0 0 16px #fff; transform:scale(1.1); }
  100% { text-shadow:0 0 4px #fff; transform:scale(1); }
}
</style>
</head>
<body>

<div id="startScreen">
  🎮 宝箱をタッチして壊せ！💥
  <button id="startBtn">スタート！</button>
</div>

<button id="chestBtn">🎁</button>

<div id="win">
  <span class="rainbow">🌈 みわ、おつかれ！！ 🌈</span>
  宝箱破壊<br>やったね♪🥳<br>
  <span>スタバチケットゲット！！<br>おめでとう！</span><br><br>
  <a id="openGift" href="https://gift.starbucks.co.jp/c/17613tZY0J2rqLzTpgIGDIilMYD60Brq" target="_blank">☕ チケットを取りに行く。こちら</a><br><br>
  by ギター侍
</div>

<audio id="tapSound"  src="tap.mp3"></audio>
<audio id="boomSound" src="boom.mp3"></audio>
<audio id="clearSound" src="clear.mp3"></audio>
<audio id="bgm"       src="bgm2.mp3" loop></audio>

<script>
const btn = chestBtn;
const funnyTexts=[
  "みわっち！<br>ハイサイ！💪",
  "ここからは<br>ゆっくり期間<br>だな！🌿",
  "いつでも<br>頼ってな～😊",
  "体調には<br>気を付けて！<br>元気でね～！🍀",
  "顔も笑顔も<br>宇宙一！",
  "黄金世代<br>卒業だな！笑",
  "一緒に働けて<br>よかった！<br>元気もらえた！",
  "楽しい思い出<br>いっぱいだった！🎉",
  "5000円の<br>しまねこプリン<br>覚えてるよ😋",
  "またビリヤード<br>やろうな！<br>次は勝つぞ～🎱",
  "お酒飲みすぎ<br>注意な🍶笑",
  "最高の友達！<br>ありがとうね！",
  "また、遊ぼう！！",
  "おつかれさまでした。",
  ""
];

let index=0, clickCount=0, scale=1;

/* バブル再利用 */
let bubbleEl=null, bubbleTimer=null;
function showBubble(text){
  if(!bubbleEl){
    bubbleEl=document.createElement("div");
    bubbleEl.className="bubble";
    document.body.appendChild(bubbleEl);
  }
  bubbleEl.innerHTML=text;
  bubbleEl.style.animation="none"; bubbleEl.offsetHeight;
  bubbleEl.style.animation="bubbleMove 6s forwards";

  clearTimeout(bubbleTimer);
  bubbleTimer=setTimeout(()=>{ bubbleEl.remove(); bubbleEl=null; },9000);
}

/* 光ぶわっ */
function burst(){
  const b=document.createElement("div");
  b.className="burst";
  document.body.appendChild(b);
  setTimeout(()=>b.remove(),600);
}

/* 紙吹雪 */
function confetti(){
  const colors=["#ff4b4b","#ffd93d","#4bff4b","#4bd8ff","#ff4bff","#ffffff"];
  for(let i=0;i<150;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*100+"vw";
    c.style.background=colors[Math.floor(Math.random()*colors.length)];
    c.style.animationDuration=(3+Math.random()*3)+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),5000);
  }
}

/* 中央禁止ゾーン */
function move(){
  const w=btn.offsetWidth,h=btn.offsetHeight;
  const maxX=innerWidth-w, maxY=innerHeight-h;
  const fx1=innerWidth*0.3, fx2=innerWidth*0.7;
  const fy1=innerHeight*0.3, fy2=innerHeight*0.7;
  let x,y,c=0;
  do{
    x=Math.random()*maxX;
    y=Math.random()*maxY;
    c++;
  }while(x>fx1&&x<fx2&&y>fy1&&y<fy2&&c<50);
  btn.style.left=x+"px"; btn.style.top=y+"px";
}

/* 連打抑制 */
let lastTap=0,TAP_CD=150;

function tap(){
  const now=performance.now();
  if(now-lastTap<TAP_CD) return;
  lastTap=now;

  clickCount++;
  scale=Math.min(scale+0.15,1.8);
  btn.style.transform=`translate(-50%,-50%) scale(${scale})`;

  btn.classList.add("shrink");
  setTimeout(()=>btn.classList.remove("shrink"),180);

  burst();

  const b=1+clickCount*0.08, s=1+clickCount*0.05;
  btn.style.filter=`brightness(${Math.min(b,1.6)}) saturate(${Math.min(s,1.4)})`;

  showBubble(funnyTexts[index]);
  index=(index+1)%funnyTexts.length;

  move();

  tapSound.playbackRate=1+Math.min(clickCount/funnyTexts.length,1)*0.25;
  tapSound.currentTime=0; tapSound.play();

  if(clickCount>=funnyTexts.length){
    btn.remove();
    boomSound.play(); clearSound.play();
    confetti();
    win.style.display="block";
  }
}

/* 音量調整 */
bgm.volume=0.12; tapSound.volume=0.35; boomSound.volume=0.5; clearSound.volume=0.4;

/* スタバ → BGM停止 */
openGift.onclick=()=>{ bgm.pause(); };

/* Start */
startBtn.onclick=()=>{ startScreen.remove(); btn.style.display="block"; bgm.play(); move(); }
btn.addEventListener("pointerdown",e=>{e.preventDefault(); tap();},{passive:false});
</script>
</body>
</html>
